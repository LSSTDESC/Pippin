DATAPREP:
  DATALOWZ:  # lowz combined sample
    EXTERNAL: $PIPPIN_OUTPUT/REF_DATA/0_DATAPREP/DATALOWZ
  DATAFOUND:  # Foundation sample
    EXTERNAL: $PIPPIN_OUTPUT/REF_DATA/0_DATAPREP/DATAFOUND
  DATADES5YR:  # 5 yr photometry sample
    EXTERNAL: $PIPPIN_OUTPUT/REF_DATA/0_DATAPREP/DATADES5YR

SIM:
  DESSIMBIAS5YRIA_C11:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/DESSIMBIAS5YRIA_C11
  DESSIMBIAS5YRIA_G10:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/DESSIMBIAS5YRIA_G10
  DESSIMBIAS5YRCC:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/DESSIMBIAS5YRCC

  LOWZSIMBIAS_G10:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/LOWZSIMBIAS_G10
  LOWZSIMBIAS_C11:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/LOWZSIMBIAS_C11

  FOUNDSIMBIAS_G10:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/FOUNDSIMBIAS_G10
  FOUNDSIMBIAS_C11:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/FOUNDSIMBIAS_C11

LCFIT:
  D:
    BASE: surveys/des/lcfit_nml/des_5yr.nml
    MASK: DES
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/D_DESSIMBIAS5YRIA_C11
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/D_DESSIMBIAS5YRIA_G10
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/D_DESSIMBIAS5YRCC
      - $PIPPIN_OUTPUT/REF_DATA/2_LCFIT/D_DATADES5YR

  L:
    BASE: surveys/lowz/lcfit_nml/lowz.nml
    MASK: LOWZ
    SNLCINP:
      USE_MINOS: F
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 20
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/L_LOWZSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/L_LOWZSIMBIAS_C11
      - $PIPPIN_OUTPUT/REF_DATA/2_LCFIT/L_DATALOWZ

  F:
    BASE: surveys/foundation/lcfit_nml/foundation.nml
    MASK: FOUND
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2b.TEMPLATE 20
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/F_FOUNDSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/F_FOUNDSIMBIAS_C11
      - $PIPPIN_OUTPUT/REF_DATA/2_LCFIT/F_DATAFOUND

CLASSIFICATION:
  SNNTEST:
    CLASSIFIER: SuperNNovaClassifier
    MODE: predict
    MASK_SIM: DES
    OPTS:
      MODEL: $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTRAIN_DESTRAIN/model.pt
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTEST_DESSIMBIAS5YRIA_C11_SNNTRAIN_DESTRAIN
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTEST_DESSIMBIAS5YRIA_G10_SNNTRAIN_DESTRAIN
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTEST_DESSIMBIAS5YRCC_SNNTRAIN_DESTRAIN

  FITPROBTEST:
    CLASSIFIER: FitProbClassifier
    MODE: predict
    MASK_SIM: DES
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/FITPROBTEST_D_DESSIMBIAS5YRIA_C11
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/FITPROBTEST_D_DESSIMBIAS5YRIA_G10
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/FITPROBTEST_D_DESSIMBIAS5YRCC

  SNIRFTEST:
    CLASSIFIER: SnirfClassifier
    MODE: predict
    MASK_SIM: DES
    OPTS:
      MODEL: $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNIRFTRAIN_D_DESTRAIN/model.pkl
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNIRFTEST_D_DESSIMBIAS5YRIA_C11_SNIRFTRAIN_D_DESTRAIN
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNIRFTEST_D_DESSIMBIAS5YRIA_G10_SNIRFTRAIN_D_DESTRAIN
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNIRFTEST_D_DESSIMBIAS5YRCC_SNIRFTRAIN_D_DESTRAIN

AGGREGATION:
  AGG:
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_DESSIMBIAS5YRIA_C11
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_DESSIMBIAS5YRIA_G10
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_DESSIMBIAS5YRCC
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_LOWZSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_LOWZSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_FOUNDSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_FOUNDSIMBIAS_G10
MERGE:
  MERGE:
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_D_DESSIMBIAS5YRIA_C11
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_D_DESSIMBIAS5YRIA_G10
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_D_DESSIMBIAS5YRCC
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_L_LOWZSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_L_LOWZSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_F_FOUNDSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_F_FOUNDSIMBIAS_G10

BIASCOR:
  ALL:
    DATA: [D_DATADES5YR, L_DATALOWZ, F_DATAFOUND]
    SIMFILE_BIASCOR: [D_DESSIMBIAS5YRIA_G10, L_LOWZSIMBIAS_G10, F_FOUNDSIMBIAS_G10]
    SIMFILE_CCPRIOR: D_DESSIMBIAS5YRCC
    CLASSIFIER: SNNTEST
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 10

  DES_LOWZ:
    DATA: [D_DATADES5YR, L_DATALOWZ]
    SIMFILE_BIASCOR: [D_DESSIMBIAS5YRIA_G10, L_LOWZSIMBIAS_G10]
    SIMFILE_CCPRIOR: D_DESSIMBIAS5YRCC
    CLASSIFIER: SNNTEST
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 10

  DES_FOUND:
    DATA: [ D_DATADES5YR, F_DATAFOUND ]
    SIMFILE_BIASCOR: [ D_DESSIMBIAS5YRIA_G10, F_FOUNDSIMBIAS_G10 ]
    SIMFILE_CCPRIOR: D_DESSIMBIAS5YRCC
    CLASSIFIER: SNNTEST
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 10

  DES:
    DATA: [ D_DATADES5YR]
    SIMFILE_BIASCOR: [ D_DESSIMBIAS5YRIA_G10 ]
    SIMFILE_CCPRIOR: D_DESSIMBIAS5YRCC
    CLASSIFIER: SNNTEST
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 10

CREATE_COV:
  ALL:

COSMOMC:
  SN_OMW:
    OPTS:
      INI: sn_omw.ini

ANALYSE:
  5YR_COMBINED:
    MASK_COSMOMC: OMW
#    MASK_BIASCOR: 5YR
