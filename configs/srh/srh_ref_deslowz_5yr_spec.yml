DATAPREP:
  DATALOWZ:  # lowz combined sample
    OPTS:
      RAW_DIR: $DES_ROOT/lcmerge/DES3YR_LOWZ_COMBINED_FITS
      TYPES:
        IA: [1, 101]
        NONIA: [120, 130, 20, 30]
      BLIND: True

  DATAFOUND:  # Foundation sample
    OPTS:
      RAW_DIR: $SNDATA_ROOT/lcmerge/Foundation_DR1
      TYPES:
        IA: [1, 101]
        NONIA: [120, 130, 20, 30]
      BLIND: True

  DATADES5YR:  # 5 yr photometry sample
    OPTS:
      RAW_DIR: $DES_ROOT/lcmerge/DESALL_specType_forcePhoto_real_snana_tex
      TYPES:
        IA: [1, 101]
        NONIA: [120, 130, 20, 30, 105, 106]
      BLIND: True


SIM:
  DESSIMBIAS5YRIA_C11:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/DESSIMBIAS5YRIA_C11
  DESSIMBIAS5YRIA_G10:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/DESSIMBIAS5YRIA_G10
  DESSIMBIAS5YRCC:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/DESSIMBIAS5YRCC

  LOWZSIMBIAS_G10:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/LOWZSIMBIAS_G10
  LOWZSIMBIAS_C11:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/LOWZSIMBIAS_C11

  FOUNDSIMBIAS_G10:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/FOUNDSIMBIAS_G10
  FOUNDSIMBIAS_C11:
    EXTERNAL: $PIPPIN_OUTPUT/GLOBAL/1_SIM/FOUNDSIMBIAS_C11

LCFIT:
  DS:
    BASE: surveys/des/lcfit_nml/des_5yr.nml
    MASK: DATADES
    FITOPTS: surveys/global/lcfit_fitopts/global.yml
    SNLCINP:
      SNTYPE_LIST: 1,101
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 20


  # For the biascor sims, fit without fitopt
  D:
    BASE: surveys/des/lcfit_nml/des_5yr.nml
    MASK: DESSIM
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/D_DESSIMBIAS5YRIA_C11
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/D_DESSIMBIAS5YRIA_G10
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/D_DESSIMBIAS5YRCC

  LS:
    BASE: surveys/lowz/lcfit_nml/lowz.nml
    MASK: DATALOWZ
    FITOPTS: surveys/global/lcfit_fitopts/global.yml
    SNLCINP:
      USE_MINOS: F
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 20
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/REF_DATA/2_LCFIT/LS_DATALOWZ

  L:
    BASE: surveys/lowz/lcfit_nml/lowz.nml
    MASK: LOWZSIM
    SNLCINP:
      USE_MINOS: F
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 20
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/L_LOWZSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/L_LOWZSIMBIAS_C11

  FS:
    BASE: surveys/foundation/lcfit_nml/foundation.nml
    MASK: DATAFOUND
    FITOPTS: surveys/global/lcfit_fitopts/global.yml
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2b.TEMPLATE 20
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/REF_DATA/2_LCFIT/FS_DATAFOUND

  F:
    BASE: surveys/foundation/lcfit_nml/foundation.nml
    MASK: FOUNDSIM
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2b.TEMPLATE 20
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/F_FOUNDSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/2_LCFIT/F_FOUNDSIMBIAS_C11

CLASSIFICATION:
  SNNTEST:
    CLASSIFIER: SuperNNovaClassifier
    MODE: predict
    MASK_SIM: DES
    OPTS:
      MODEL: $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTRAIN_DESTRAIN/model.pt
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTEST_DESSIMBIAS5YRIA_C11_SNNTRAIN_DESTRAIN
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTEST_DESSIMBIAS5YRIA_G10_SNNTRAIN_DESTRAIN
      - $PIPPIN_OUTPUT/GLOBAL/3_CLAS/SNNTEST_DESSIMBIAS5YRCC_SNNTRAIN_DESTRAIN

AGGREGATION:
  AGG:
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_DESSIMBIAS5YRIA_C11
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_DESSIMBIAS5YRIA_G10
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_DESSIMBIAS5YRCC
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_LOWZSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_LOWZSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_FOUNDSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/4_AGG/AGG_FOUNDSIMBIAS_G10
MERGE:
  MERGE:
    EXTERNAL_DIRS:
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_D_DESSIMBIAS5YRIA_C11
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_D_DESSIMBIAS5YRIA_G10
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_D_DESSIMBIAS5YRCC
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_L_LOWZSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_L_LOWZSIMBIAS_G10
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_F_FOUNDSIMBIAS_C11
      - $PIPPIN_OUTPUT/GLOBAL/5_MERGE/MERGE_F_FOUNDSIMBIAS_G10

BIASCOR:
  5YR:
    DATA: [DS_DATADES5YR, LS_DATALOWZ, FS_DATAFOUND]
    SIMFILE_BIASCOR: [D_DESSIMBIAS5YRIA_G10, L_LOWZSIMBIAS_G10, F_FOUNDSIMBIAS_G10]
    SIMFILE_CCPRIOR: D_DESSIMBIAS5YRCC
    CLASSIFIER: SNNTEST
    MUOPTS:
      SCATTER_C11:
        SIMFILE_BIASCOR: [D_DESSIMBIAS5YRIA_C11, L_LOWZSIMBIAS_C11, F_FOUNDSIMBIAS_C11]
    OPTS:
      BATCH_INFO: sbatch $SBATCH_TEMPLATES/SBATCH_Midway2_10hr.TEMPLATE 40
      idsurvey_list_probcc0: CFA3K,CFA4p1,CFA4p2,CSP,CFA3S,FOUNDATION,DES


CREATE_COV:
  ALL:
    OPTS:
      COVOPTS:
        - "[NOSYS] [=DEFAULT,=DEFAULT]"
        - "[SCATTER] [=DEFAULT,+SCATTER]"
        - "[CLASSIFICATION] [=DEFAULT,+CLAS]"
        - "[SALT2] [+SALT2,=DEFAULT]"
        - "[survcal] [+SURVCAL,=DEFAULT]"
        - "[DES] [+DES,=DEFAULT]"
        - "[LOWZ] [+LOWZ,=DEFAULT]"
        - "[PS1] [+PS1,=DEFAULT]"

  SALT2:
    OPTS:
      INI: sn_prior_omw.ini
      FITOPT_SCALES:
        SALT20_cal: 1.0
        SALT21_cal: 1.0
        SALT22_cal: 1.0
        SALT23_cal: 1.0
        SALT24_cal: 1.0
        SALT25_cal: 1.0
        SALT26_cal: 1.0
        SALT27_cal: 1.0
        SALT28_cal: 1.0
        SALT29_cal: 1.0
      COVOPTS:
        - "[NOSYS] [=DEFAULT,=DEFAULT]"
        - "[SALT20_cal] [=SALT20_cal,=DEFAULT]"
        - "[SALT21_cal] [=SALT21_cal,=DEFAULT]"
        - "[SALT22_cal] [=SALT22_cal,=DEFAULT]"
        - "[SALT23_cal] [=SALT23_cal,=DEFAULT]"
        - "[SALT24_cal] [=SALT24_cal,=DEFAULT]"
        - "[SALT25_cal] [=SALT25_cal,=DEFAULT]"
        - "[SALT26_cal] [=SALT26_cal,=DEFAULT]"
        - "[SALT27_cal] [=SALT27_cal,=DEFAULT]"
        - "[SALT28_cal] [=SALT28_cal,=DEFAULT]"
        - "[SALT29_cal] [=SALT29_cal,=DEFAULT]"


COSMOMC:
  SN_OMW:
    MASK: ALL
    OPTS:
      INI: sn_omw.ini
      COVOPTS: [ALL, NOSYS]

  PRIOR:
    OPTS:
      INI: sn_prior_omw.ini

ANALYSE:
  5YR_COMBINED:
    MASK_COSMOMC: SN_OMW
    MASK_BIASCOR: 5YR

  5YR_ERRBUDGET:
    MASK_COSMOMC: PRIOR
